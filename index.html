<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chaldea Terminal v2.0</title>
    <style>
        :root {
            --fgo-blue: #0a2846;
            --fgo-light-blue: #57a9ff;
            --fgo-gold: #ffcc00;
            --fgo-text: #d1e8ff;
            --fgo-bg: radial-gradient(circle, #102a43 0%, #06111a 100%);
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--fgo-bg);
            color: white;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* æ‰«æçº¿æ•ˆæœ */
        body::before {
            content: " ";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0) 2px);
            pointer-events: none;
            z-index: 100;
        }

        #app {
            width: 95%;
            max-width: 900px;
            height: 650px;
            background: rgba(10, 40, 70, 0.9);
            border: 2px solid var(--fgo-light-blue);
            box-shadow: 0 0 30px rgba(0, 160, 255, 0.5);
            border-radius: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        .status-bar {
            height: 40px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--fgo-light-blue);
            font-size: 14px;
        }

        .resource { display: flex; gap: 15px; }
        .resource span { color: var(--fgo-gold); }

        /* å†…å®¹åŒº */
        .screen {
            flex: 1;
            padding: 30px;
            display: none;
            overflow-y: auto;
        }

        .screen.active { display: block; }

        /* æ ‡é¢˜æ ·å¼ */
        h1 { color: var(--fgo-light-blue); text-align: center; letter-spacing: 4px; text-transform: uppercase; }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: rgba(87, 169, 255, 0.2);
            border: 1px solid var(--fgo-light-blue);
            color: white;
            padding: 12px 25px;
            margin: 10px 0;
            cursor: pointer;
            transition: 0.3s;
            display: block;
            width: 100%;
            text-align: center;
            border-radius: 4px;
            font-size: 16px;
        }

        .btn:hover { background: var(--fgo-light-blue); color: black; }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--fgo-light-blue); }
        input {
            width: 100%;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--fgo-light-blue);
            color: white;
            box-sizing: border-box;
        }

        /* å‰§æƒ…å¯¹è¯æ¡† */
        .dialog-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 5px;
            border-left: 5px solid var(--fgo-gold);
            margin-bottom: 20px;
            min-height: 100px;
            line-height: 1.8;
        }

        .davinci-avatar {
            font-weight: bold;
            color: var(--fgo-gold);
            margin-bottom: 10px;
            display: block;
        }

        /* å­˜æ¡£ä½ */
        .save-slot {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            margin-bottom: 10px;
            border: 1px dashed var(--fgo-light-blue);
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="status-bar">
        <div>SYSTEM: <span id="model-name">DISCONNECTED</span></div>
        <div class="resource">
            <span>ğŸ’ <span id="sq-count">30</span></span>
            <span>âš¡ AP <span id="ap-count">3</span>/3</span>
        </div>
    </div>

    <div id="home-screen" class="screen active">
        <h1 style="margin-top: 80px;">CHALDEA COMMANDER</h1>
        <p style="text-align: center; color: var(--fgo-text);">ä¸‡èƒ½çš„å¤©æ‰è¾¾èŠ¬å¥‡äº²ï¼Œä¸ºæ‚¨æœåŠ¡ã€‚</p>
        <div style="max-width: 300px; margin: 50px auto;">
            <button class="btn" onclick="navTo('api-screen')">å¼€å§‹/åˆå§‹åŒ–ç³»ç»Ÿ</button>
            <button class="btn" onclick="navTo('save-screen')">è½½å…¥è®°å½•</button>
        </div>
    </div>

    <div id="api-screen" class="screen">
        <h2>âš™ï¸ API ç¥ç»å…ƒé“¾æ¥é…ç½®</h2>
        <div class="input-group">
            <label>API ç«¯ç‚¹ (Endpoint)</label>
            <input type="text" id="api-endpoint" value="https://api.openai.com/v1">
        </div>
        <div class="input-group">
            <label>API å¯†é’¥ (Secret Key)</label>
            <input type="password" id="api-key" placeholder="sk-...">
        </div>
        <div class="input-group">
            <label>è‡ªå®šä¹‰æ¨¡å‹åç§°</label>
            <input type="text" id="api-model" value="Gemini-Flash-3.0">
        </div>
        <button class="btn" onclick="testConnection()" id="test-btn">æµ‹è¯•çµå­é“¾æ¥</button>
        <button class="btn" id="start-game-btn" onclick="startGame()" style="display:none; border-color: var(--fgo-gold); color: var(--fgo-gold);">è¿›å…¥è¿¦å‹’åº•</button>
        <button class="btn" onclick="navTo('home-screen')">è¿”å›é¦–é¡µ</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="dialog-box">
            <span class="davinci-avatar">è¾¾èŠ¬å¥‡äº²ï¼š</span>
            <div id="story-text">æ­£åœ¨åŒæ­¥çµåŸºä¿¡æ¯... è¿™é‡Œçš„ç¯å¢ƒè¿˜ä¹ æƒ¯å—ï¼ŒMasterï¼Ÿ</div>
        </div>
        <div id="options-container">
            </div>
    </div>

    <div id="save-screen" class="screen">
        <h2>ğŸ’¾ çµåŸºå¿«ç…§è®°å½•</h2>
        <div id="save-list">
            <div class="save-slot">
                <span>è®°å½• 01: åˆå§‹çŠ¶æ€ (ç›ä¿®)</span>
                <button onclick="alert('å­˜æ¡£å·²åŠ è½½')">è½½å…¥</button>
            </div>
            <div class="save-slot" style="opacity: 0.5;">
                <span>è®°å½• 02: ç©ºç™½</span>
                <button disabled>è½½å…¥</button>
            </div>
        </div>
        <button class="btn" onclick="navTo('home-screen')">è¿”å›</button>
    </div>
</div>

<script>
    let gameState = {
        sq: 30,
        ap: 3,
        servants: [{name: "ç›ä¿®", class: "Shielder", lv: 1}],
        apiConnected: false
    };

    function navTo(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');
    }

    function testConnection() {
        const btn = document.getElementById('test-btn');
        const model = document.getElementById('api-model').value;
        btn.innerText = "æ­£åœ¨åŒæ­¥çµå­é¢‘ç‡...";
        
        // æ¨¡æ‹ŸAPIæµ‹è¯•å»¶è¿Ÿ
        setTimeout(() => {
            if(document.getElementById('api-key').value.length < 5) {
                alert("é”™è¯¯ï¼šçµå­å¯†é’¥æ ¡éªŒå¤±è´¥ï¼è¯·è¾“å…¥æ­£ç¡®çš„å¯†é’¥ã€‚");
                btn.innerText = "é‡æ–°æµ‹è¯•";
            } else {
                alert("åŒæ­¥æˆåŠŸï¼æ¨¡å‹ " + model + " å·²å‡†å¤‡å°±ç»ªã€‚");
                gameState.apiConnected = true;
                document.getElementById('model-name').innerText = model;
                document.getElementById('start-game-btn').style.display = 'block';
                btn.style.display = 'none';
            }
        }, 1500);
    }

    function startGame() {
        navTo('game-screen');
        renderStory("æ¬¢è¿æ¥åˆ°è¿¦å‹’åº•ï¼æˆ‘æ˜¯è¿™é‡Œçš„ä»£ç†æ‰€é•¿ï¼ˆè‡ªç§°ï¼‰ï¼Œä¸‡èƒ½çš„å¤©æ‰è¾¾èŠ¬å¥‡äº²ï¼æ—¢ç„¶ç³»ç»Ÿå·²ç»é…ç½®å®Œæˆï¼Œæˆ‘ä»¬å¾—å…ˆå¤„ç†ä¸€ä¸‹ç›®å‰çš„èµ„äº§ã€‚ä½ çœ‹ï¼Œé‚£ 30 é¢—åœ£æ™¶çŸ³æ­£é—ªé—ªå‘å…‰å‘¢ï¼Œä½ æ˜¯æ‰“ç®—å…ˆæ‰©å……ä¸€ä¸‹æˆ˜åŠ›ï¼Œè¿˜æ˜¯å…ˆå»è·Ÿç›ä¿®æ‰“ä¸ªæ‹›å‘¼ï¼Ÿ", [
            { text: "â‘  å‰å¾€å¬å”¤å®¤ (åä¸€è¿å¬å”¤)", action: "summon" },
            { text: "â‘¡ çœ‹çœ‹ç›ä¿®çš„çŠ¶æ€ (äº’åŠ¨)", action: "mashu" },
            { text: "â‘¢ æ‰§è¡Œ [çµåŸºè¡¥èƒ½] (æŒ‡ä»¤â‘¢)", action: "mana" },
            { text: "â‘£ æŸ¥çœ‹å…¨é‡è‹±çµåˆ—è¡¨ (å¯¹è´¦)", action: "list" }
        ]);
    }

    function renderStory(text, options) {
        document.getElementById('story-text').innerText = text;
        const container = document.getElementById('options-container');
        container.innerHTML = '';
        options.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'btn';
            b.innerText = opt.text;
            b.onclick = () => handleAction(opt.action);
            container.appendChild(b);
        });
    }

    function handleAction(action) {
        if (action === 'summon') {
            if(gameState.sq < 30) { alert("åœ£æ™¶çŸ³ä¸è¶³ï¼"); return; }
            gameState.sq -= 30;
            document.getElementById('sq-count').innerText = gameState.sq;
            renderStory("å¬å”¤é˜µçˆ†å‘å‡ºé“¶è“è‰²çš„å…‰èŠ’ï¼æ­å–œä½ ï¼Œè·å¾—äº†æ–°çš„çµåŸºï¼ˆæ¨¡æ‹Ÿé€»è¾‘ï¼šè·å¾—â˜…4ä»è€…ä¸€åï¼‰ã€‚ç°åœ¨ä½ çš„é˜Ÿä¼å£®å¤§äº†ï¼", [
                { text: "æŸ¥çœ‹æœ€æ–°è‹±çµåå•", action: "list" },
                { text: "ç»§ç»­è¡ŒåŠ¨", action: "back" }
            ]);
        } else if (action === 'mana') {
            renderStory("ï¼ˆä½ é€‰æ‹©äº†æŒ‡ä»¤â‘¢ï¼‰è¾¾èŠ¬å¥‡éœ²å‡ºäº†æˆè°‘çš„ç¬‘å®¹ï¼Œå°†å¯†å®¤é”æ­»ã€‚ç›ä¿®çš„è„¸å¾®å¾®æ³›çº¢ï¼š'Master... å¦‚æœæ˜¯æ‚¨çš„æ„å¿—ï¼Œæˆ‘æ„¿æ„æ¥å—é­”åŠ›ä¾›ç»™ã€‚' ç¯å¢ƒå·²è¿›å…¥æ·±åº¦æ¨¡å¼...", [
                { text: "å¼€å§‹è¡¥èƒ½ (å¾¡ä¸»ä¸»å¯¼)", action: "mana_start" },
                { text: "æ’¤å›æŒ‡ä»¤", action: "back" }
            ]);
        } else if (action === 'back' || action === 'list') {
            startGame();
        }
    }
</script>

</body>
</html>
